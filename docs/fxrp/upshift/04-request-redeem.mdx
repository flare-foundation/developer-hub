---
title: Request Redeem from Upshift Vault
tags: [intermediate, upshift, fassets]
slug: request-redeem
description: Learn how to request a delayed redemption from an Upshift vault
keywords: [fassets, flare-network, fxrp, upshift, vault, redeem, withdrawal]
sidebar_position: 4
---

import CodeBlock from "@theme/CodeBlock";
import UpshiftRequestRedeem from "!!raw-loader!/examples/developer-hub-javascript/upshift-request-redeem.ts";

This guide demonstrates how to request a delayed redemption from an Upshift vault.
The Upshift vault implements an [ERC-4626](https://eips.ethereum.org/EIPS/eip-4626) style tokenized vault that supports requested redemptions with a lower fee than instant redemptions.

Requesting a redemption locks your LP tokens (vault shares) and creates a withdrawal request.
After the lag duration passes, you can claim your assets using the [claim redemption script](/fxrp/upshift/claim).

## Prerequisites

- [Flare Hardhat Starter Kit](/network/guides/hardhat-foundry-starter-kit)
- [Flare Network Periphery Contracts](https://www.npmjs.com/package/@flarenetwork/flare-periphery-contracts)
- Understanding of [FAssets](/fassets/overview)
- LP tokens (vault shares) in the Upshift vault to redeem.

## Upshift Vault Request Redeem Script

The following script demonstrates how to request a delayed redemption from the Upshift vault:

<CodeBlock language="typescript" title="scripts/upshift/requestRedeem.ts">
  {UpshiftRequestRedeem}
</CodeBlock>

## Script Breakdown

The `main()` function executes the following steps:

1. **Initialize:** Gets the user account and logs the vault and user addresses.
2. **Connect to vault:** Creates an instance of the Upshift vault contract.
3. **Get reference asset info:** Retrieves the vault's reference asset (FXRP) address, symbol, and decimals.
4. **Get LP token info:** Retrieves the LP token address and the user's current LP balance.
5. **Validate balance:** Converts the shares amount and checks if the user has sufficient LP tokens.
6. **Approve LP allowance:** Approves the vault to spend LP tokens if the current allowance is insufficient.
7. **Check vault configuration:** Verifies withdrawals are not paused and the amount doesn't exceed maximum limits.
8. **Preview redemption:** Calls [`previewRedemption()`](https://docs.upshift.finance/developer-docs/vault-contract-interface#id-8.-previewredeem-uint256-shares) to see expected assets before and after the withdrawal fee.
9. **Print withdrawal epoch:** Displays the current epoch and claimable epoch information.
10. **Execute request redeem:** Calls [`requestRedeem()`](https://docs.upshift.finance/developer-docs/vault-contract-interface#id-2.-requestredeem-uint256-shares-address-receiveraddr-address-holderaddr) to lock LP tokens and create a withdrawal request.
11. **Verify request:** Confirms the request by checking the updated LP balance and showing when assets can be claimed.

## Understanding Requested Redemption

The Upshift vault supports two types of redemptions:

- **Instant Redemption**: Immediately burns LP tokens and returns assets, but incurs an instant redemption fee.
- **Requested Redemption**: Creates a withdrawal request that is processed after a lag period, with a lower fee.

The requested redemption process works as follows:

1. **Request**: Call [`requestRedeem()`](https://docs.upshift.finance/developer-docs/vault-contract-interface#id-2.-requestredeem-uint256-shares-address-receiveraddr-address-holderaddr) to lock your LP tokens and create a withdrawal request for the current epoch.
2. **Wait**: The lag duration must pass before you can claim your assets.
3. **Claim**: After the lag period execute the [claim redemption script](/fxrp/upshift/claim) to receive your assets.

This delayed mechanism allows the vault to manage liquidity more efficiently while offering users a lower fee option.

## Running the Script

To run the Upshift vault request redeem script:

1. Ensure you have the [Flare Hardhat Starter Kit](/network/guides/hardhat-foundry-starter-kit) set up.
2. Update the `VAULT_ADDRESS` constant with the correct vault address for your network.
3. Adjust the `SHARES_TO_REDEEM` constant to the desired number of shares.
4. Ensure your account has sufficient LP tokens (vault shares) to cover the redemption.
5. Run the script using Hardhat:

```bash
npx hardhat run scripts/upshift/requestRedeem.ts --network coston2
```

## Output

The script outputs the following information about the request redemption:

```bash
REQUEST REDEEM FROM VAULT

Vault Address: 0x24c1a47cD5e8473b64EAB2a94515a196E10C7C81
User Address: 0x0d09ff7630588E05E2449aBD3dDD1D8d146bc5c2
Reference Asset (asset receiving): 0x0b6A3645c240605887a5532109323A3E12273dc7

LP Balance: 10.0
Shares to Redeem: 1 (1000000)

Current LP Allowance: 0.0

Approving vault to spend 1 LP tokens...
Approval Tx: 0x87a36c1009575719fd3adb9a1bb2e3062a601bf910fc7fac3248da71891c39a4

Lag Duration: 86400 seconds
Withdrawal Fee: 0.5%
Withdrawals Paused: false
Max Withdrawal Amount: 1000000.0 FTestXRP

Expected Assets (before fee): 1.0 FTestXRP
Expected Assets (after fee): 0.995 FTestXRP

Current Epoch - Year: 2025, Month: 1, Day: 15
Claimable Epoch: 14

Request Redeem: (tx: 0x3f1bd8c766852d3b835bcde79f6d8e20afeeb227d737e0ed28d057dc0e6b2ba9 , block: 12345678 )
LP Balance After: 9.0
Shares Locked: 1.0

Claim your assets after: 2025/1/16
```

## Summary

In this guide, you learned how to request a delayed redemption from an Upshift vault by specifying the number of LP tokens (shares) to redeem.
The requested redemption has a lower fee than instant redemption but requires waiting for the lag duration before claiming your assets.

:::tip[What's next]

To continue your Upshift development journey, you can:

- Learn how to [get Upshift vault status](/fxrp/upshift/status) to monitor your redemption requests.
- Learn how to [claim assets from an Upshift vault](/fxrp/upshift/claim) after your requested redemption is claimable.
- Learn how to [instantly redeem from an Upshift vault](/fxrp/upshift/instant-redeem) for immediate liquidity.
- Learn how to [deposit assets into an Upshift vault](/fxrp/upshift/deposit).
- Learn more about [FAssets](/fassets/overview) and how the system works.

:::
