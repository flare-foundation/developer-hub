---
title: Redeem FAssets
tags: [intermediate, fassets]
slug: fassets-redeem
description: Learn how to redeem FAssets
keywords: [fassets, flare-network]
sidebar_position: 3
---

import CodeBlock from "@theme/CodeBlock";
import Remix from "@site/src/components/remix";
import FAssetsRedeem from "!!raw-loader!/examples/developer-hub-solidity/FAssetsRedeem.sol";

## Overview

The [FAssets](/fassets/overview) system on the Flare Network enables users to interact with non-smart-contract chains (like XRP, BTC, DOGE) by wrapping their tokens into smart contract-compatible assets â€” called FAssets.

[Redemption](/fassets/redemption) is the process of burning FAssets (e.g., FXRP) on Flare in exchange for their equivalent value on the original chain (e.g., XRP on XRPL).

In this guide, you will learn how to redeem FAssets using asset manager smart contract.

## Prerequisites

- [Flare Hardhat Starter Kit](/network/guides/hardhat-foundry-starter-kit#hardhat)
- [Flare Network Periphery Contracts](https://www.npmjs.com/package/@flarenetwork/flare-periphery-contracts)

## Redeem FAssets Smart Contract

The following example demonstrates how to redeem FAssets using the `AssetManager` smart contract.

<CodeBlock language="solidity" title="contracts/FAssetsRedeem.sol">
  {FAssetsRedeem}
</CodeBlock>

{/* prettier-ignore */}
<Remix fileName="FAssetsRedeem.sol">Open in Remix</Remix>
<br></br>

### Code Breakdown

1. Define the `FAssetsRedeem` contract.
2. Get the asset manager settings to calculate the redeemed amount; for that, you need to get the `lotSizeAMG` and `assetDecimals` from the asset manager [settings](/fassets/developer-guides/fassets-settings-solidity).
3. Redeem the FAssets using the [`redeem`](/fassets/reference/IAssetManager#redeem) function by specifying the number of lots to redeem and the underlying chain address.

## Deploy and Interact with the Smart Contract

To deploy the contract and redeem FAssets you can use the [Flare Hardhat Starter Kit](/network/guides/hardhat-foundry-starter-kit#hardhat).

### Import the Required Contracts

At first, you need to import the required dependencies and contract types:

```typescript
import { ethers, run } from "hardhat";
import { ContractTransactionReceipt, formatUnits } from "ethers";

import {
  FAssetsRedeemContract,
  FAssetsRedeemInstance,
  IAssetManagerContract,
  ERC20Instance,
} from "../../typechain-types";
```

### Define the Constants

Define the constants:

- asset manager address;
- the number of lots to redeem;
- underlying chain address where the redeemed asset will be sent;
- FXRP token address.

```typescript
// AssetManager address on Songbird Testnet Coston network
const ASSET_MANAGER_ADDRESS = "0x56728e46908fB6FcC5BCD2cc0c0F9BB91C3e4D34";
const LOTS_TO_REDEEM = 1;
const UNDERLYING_ADDRESS = "rSHYuiEvsYsKR8uUHhBTuGP5zjRcGt4nm";
const FXRP_TOKEN_ADDRESS = "0x36be8f2e1CC3339Cf6702CEfA69626271C36E2fd";
```

### Deploy and Verify the Redeem Contract

To deploy and verify the smart contract you can use the following function:

```typescript
async function deployAndVerifyContract() {
  const FAssetsRedeem = (await ethers.getContractFactory(
    "FAssetsRedeem",
  )) as FAssetsRedeemContract;

  const args = [ASSET_MANAGER_ADDRESS];
  const fAssetsRedeem = (await FAssetsRedeem.deploy(
    ...args,
  )) as FAssetsRedeemInstance;
  await fAssetsRedeem.waitForDeployment();
  const fAssetsRedeemAddress = await fAssetsRedeem.getAddress();

  try {
    await run("verify:verify", {
      address: fAssetsRedeemAddress,
      constructorArguments: args,
    });
  } catch (e: any) {
    console.log(e);
  }

  console.log("FAssetsRedeem deployed to:", fAssetsRedeemAddress);

  return fAssetsRedeem;
}
```

### Transfer FXRP to the Redeem Contract

To redeem FAssets, the invoker must have enough FAssets.
In this case, the invoker is the `FAssetsRedeem` contract.
You need to transfer FXRP to the `FAssetsRedeem` contract address after it is deployed.

```typescript
async function transferFXRP(
  fAssetsRedeemAddress: string,
  amountToRedeem: number,
) {
  // Get FXRP token contract
  const fxrp = (await ethers.getContractAt(
    "IERC20",
    FXRP_TOKEN_ADDRESS,
  )) as ERC20Instance;

  // Transfer FXRP to the deployed contract
  console.log("Transferring FXRP to contract...");
  const transferTx = await fxrp.transfer(fAssetsRedeemAddress, amountToRedeem);
  await transferTx.wait();
  console.log("FXRP transfer completed");
}
```

:::warning
In a production environment, you should use a more secure method to transfer FXRP to a smart contract.
:::

### Parse the Redemption Events

During the redemption process, the `AssetManager` emits an events:

- [`RedemptionRequested`](/fassets/reference/IAssetManagerEvents#redemptionrequested) - holds the agent vault address, redemption request id, the amount of FAssets to redeem, and other important information.
- [`RedemptionTicketCreated`](/fassets/reference/IAssetManagerEvents#redemptionticketcreated) - holds the redemption ticket information that is updated during the redemption process.

To parse the redemption events you can use the following function:

```typescript
async function parseRedemptionEvents(
  transactionReceipt: ContractTransactionReceipt,
  fAssetsRedeem: FAssetsRedeemInstance,
) {
  console.log("\nParsing events...", transactionReceipt.logs);

  // Get AssetManager contract interface
  const assetManager = (await ethers.getContractAt(
    "IAssetManager",
    ASSET_MANAGER_ADDRESS,
  )) as IAssetManagerContract;

  for (const log of transactionReceipt.logs) {
    try {
      const parsedLog = assetManager.interface.parseLog(log);
      if (parsedLog) {
        const redemptionEvents = [
          "RedemptionRequested",
          "RedemptionTicketUpdated",
        ];
        if (redemptionEvents.includes(parsedLog.name)) {
          console.log(`\nEvent: ${parsedLog.name}`);
          console.log("Arguments:", parsedLog.args);
        }
      }
    } catch (e) {
      console.log("Error parsing event:", e);
    }
  }
}
```

### Redeeming FAssets

To put it all together you can use the following function to deploy the contract, transfer FXRP to it, redeem the FAssets and parse the redemption events:

```typescript
async function main() {
  const fAssetsRedeem: FAssetsRedeemInstance = await deployAndVerifyContract();

  const settings = await fAssetsRedeem.getSettings();
  const lotSize = settings[0];
  const decimals = settings[1];
  console.log("Lot size:", lotSize);
  console.log("Asset decimals:", decimals);

  const amountToRedeem = Number(lotSize) * Number(LOTS_TO_REDEEM);
  console.log(
    `Required FXRP amount ${formatUnits(amountToRedeem, decimals)} FXRP`,
  );
  console.log(`Required amount in base units: ${amountToRedeem.toString()}`);

  // Transfer FXRP to the contract
  await transferFXRP(fAssetsRedeem.getAddress(), amountToRedeem);

  // Call redeem function and wait for transaction
  const tx = await fAssetsRedeem.redeem(LOTS_TO_REDEEM, UNDERLYING_ADDRESS);
  const transactionReceipt = await tx.wait();
  console.log("TX receipt", transactionReceipt);

  // Parse events from the transaction
  await parseRedemptionEvents(transactionReceipt, fAssetsRedeem);
}

main().catch((error) => {
  console.error(error);
  process.exitCode = 1;
});
```

### Run the Script

Run the script using the [Flare Hardhat Starter Kit](/network/guides/hardhat-foundry-starter-kit#hardhat) with following command:

```bash
npx hardhat run scripts/fassets/getLotSize.ts --network coston
```

Once the script is executed, the main information is in two events:

#### [`RedemptionRequested`](/fassets/reference/IAssetManagerEvents#redemptionrequested)

This event contains the agent vault address, redeemer address, underlying chain address, amount of FAssets to redeem, redemption fee, and other important information.

```bash
Event: RedemptionRequested
Arguments: Result(12) [
  '0x3c831Fe4417bEFFAc721d24996985eE2dd627053',
  '0xCA7C9fBbA56E44C508bcb4872775c5fEd169cDb3',
  1898730n,
  'rSHYuiEvsYsKR8uUHhBTuGP5zjRcGt4nm',
  20000000n,
  20000n,
  6386165n,
  6386708n,
  1744293249n,
  '0x46425052664100020000000000000000000000000000000000000000001cf8ea',
  '0x0000000000000000000000000000000000000000',
  0n
]
```

When decoding an event, the most important data from the event is:

- agent vault address that will redeem the FAssets is `0x3c831Fe4417bEFFAc721d24996985eE2dd627053`;
- redeemer address is `0xCA7C9fBbA56E44C508bcb4872775c5fEd169cDb3`;
- redemption ticket id is `1898730`;
- underlying chain address is `rSHYuiEvsYsKR8uUHhBTuGP5zjRcGt4nm`;
- amount of FAssets to redeem is `20000000`;
- redemption fee is `20000`;

You can see the full event description [here](/fassets/reference/IAssetManagerEvents#redemptionrequested) section.

#### [`RedemptionTicketUpdated`](/fassets/reference/IAssetManagerEvents#redemptionticketupdated)

This event holds the redemption ticket information: agent vault address, redemption ticket id and the value of the redemption ticket in underlying chain currency.

For every minting, a redemption ticket is created, and during the redemption process, the redemption ticket is updated with the new redemption status.

```bash
Event: RedemptionTicketUpdated
Arguments: Result(3) [
  '0x3c831Fe4417bEFFAc721d24996985eE2dd627053',
  870n,
  3440000000n
]
```

Once decoding the most important data from the event is:

- agent vault address that will redeem the FAssets is `0x3c831Fe4417bEFFAc721d24996985eE2dd627053`;
- redemption ticket id is `870`;
- value of the redemption ticket in underlying chain currency is `3440000000` (partially redeemed).

You can read the full event description [here](/fassets/reference/IAssetManagerEvents#redemptionticketupdated).

## Next Steps

:::tip
This is only the first step of the redemption process. The redeemer or agent completes the redemption process when proof of payment is presented to the FAssets system. Read more about the redemption process in the [here](/fassets/redemption).
:::
