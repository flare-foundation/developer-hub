---
slug: secure-random-numbers
title: Secure Random Numbers
tags: [quickstart, solidity, javascript, python, rust, go]
authors: [dineshpinto, horiamagureanu, charlesgrover]
description: Use Flare's secure randomness in your application.
keywords:
  [
    solidity,
    javascript,
    python,
    rust,
    go,
    randomness,
    random-number,
    flare-time-series-oracle,
    flare-network,
  ]
sidebar_position: 7
---

import TabItem from "@theme/TabItem";
import Tabs from "@theme/Tabs";
import RemixEmbed from "@site/src/components/RemixEmbed";
import CodeBlock from "@theme/CodeBlock";
import SecureRandomConsumer from "!!raw-loader!/examples/developer-hub-solidity/SecureRandomConsumer.sol";
import SecureRandomWeb3Js from "!!raw-loader!/examples/developer-hub-javascript/secure_random_coston2_web3.js";
import SecureRandomEthersJs from "!!raw-loader!/examples/developer-hub-javascript/secure_random_coston2_ethers.js";
import SecureRandomWeb3Py from "!!raw-loader!/examples/developer-hub-python/secure_random_coston2.py";
import SecureRandomRust from "!!raw-loader!/examples/developer-hub-rust/src/bin/secure_random_coston2.rs";
import SecureRandomGo from "!!raw-loader!/examples/developer-hub-go/coston2/secure_random.go";
import RandomNumberV2Lottery from "!!raw-loader!/examples/developer-hub-solidity/RandomNumberV2Lottery.sol";
import YoutubeEmbed from "@site/src/components/YoutubeEmbed";

This guide shows how to obtain secure, uniform random numbers on Flare.
Secure randomness is generated by the [Scaling](/ftso/scaling/overview) protocol, where approximately 100 independent data providers generate local randomness every 90 seconds (a voting round), commit onchain, then reveal.
The protocol aggregates these values into a final, uniformly distributed random number.

As long as **any one provider** generates an honest, hidden $n$-bit random value, the sum modulo $2^n$ remains uniform.
If manipulation is detected (e.g., a reveal omission), the round's `isSecure` flag is set to false, offenders are penalized, and their values are excluded for subsequent rounds.

<details>
<summary>Understand the secure random mechanism.</summary>

As described in the [FTSOv2 whitepaper](/pdf/whitepapers/20240223-FlareTimeSeriesOracleV2.pdf), the Scaling protocol consists of the following phases:

1. **Commit:** During the Commit phase, data providers prepare their submissions for each of the data feeds and encode them into a 4-byte vector. Then, each data provider publishes on chain a hash commitment obtained as:

   `Hash(address, voting_epoch_id, random_number, price_data)`
   - **Random Number**: This Commit includes a locally generated random number.
   - **Purpose**: The random number blinds the Commit hash of the user from a search attack and is used later (once revealed) to contribute to onchain randomness.

2. **Reveal:** During the Reveal phase, each data provider reveals all inputs to their hash commitment. As such, all locally produced random numbers become available onchain.

3. **Signing:** After the Reveal phase, data providers perform a number of local computations relevant to the Scaling protocol, which include:
   - Computing the weighted median prices
   - Calculating the rewards

   All these are packaged into a Merkle root, which is published onchain together with a signature of the root.

4. **Finalization:** Once enough signatures for the same Merkle root are gathered, the process is finalized.

**Secure Random Numbers**

For each voting round (90 seconds), let each provider's random value be $r_i \in [0, 2^n -1]$. The voting round's random number is:

$$
R = \left( \sum_{i} r_i \right) \mod{2^n}
$$

Because commits are fixed before reveals, if any one $r_i$ is uniformly random and not chosen adaptively after seeing others, $R$ is uniformly random over $[0, 2^n -1]$.

</details>

## Use secure random onchain

:::tip

You can integrate secure random numbers into your application on Flare for no cost.

:::

<CodeBlock language="solidity" title="SecureRandomConsumer.sol">
  {SecureRandomConsumer}
</CodeBlock>

{/* prettier-ignore */}
<RemixEmbed fileName="SecureRandomConsumer.sol">Open in Remix</RemixEmbed>
<br></br>

In addition to the `randomNumber` itself, two other variables are retrieved:

- `isSecure`: A boolean flag indicating whether the random number was generated securely:
  - **True**: All providers that committed also revealed, and every reveal matched its commit.
  - **False**: at least one omission or mismatch occurred for the round.
    Offending providers are penalized and excluded for a number of future rounds; the voting round's randomness is flagged as unsafe.

- `timestamp`: The UNIX timestamp marking the end of the voting round during which data was collected from data providers to generate the specific number.
  Each voting round lasts for a fixed 90-second window.

:::warning[Set EVM Version to Cancun]

- **Using Remix:** Set EVM version to `cancun` under **Solidity Compiler** → **Advanced Configurations**.

- **Using Hardhat or Foundry:** Set EVM version to `cancun` in [hardhat.config.ts](https://github.com/flare-foundation/flare-hardhat-starter/blob/master/hardhat.config.ts#L34) or [foundry.toml](https://github.com/flare-foundation/flare-foundry-starter/blob/master/foundry.toml).
- **Using Standard Solidity JSON:** Set `"evmVersion": "cancun"` in `settings`.
- **Using `solc`:** Add `--evm-version cancun` flag to your command.

:::

### Example lottery application

This contract implements an example simple lottery system that utilizes a secure random number to select a winner.
Participants can enter the lottery, and the winner is drawn using the secure random number generated by `RandomNumberV2`.

<CodeBlock language="solidity" title="RandomNumberV2Lottery.sol">
  {RandomNumberV2Lottery}
</CodeBlock>

{/* prettier-ignore */}
<RemixEmbed fileName="RandomNumberV2Lottery.sol">Open in Remix</RemixEmbed>
<br></br>

## Use secure random offchain

To obtain a secure random number offchain, you need two key pieces of information:

1. **RPC Endpoint URL:** The RPC Endpoint URL determines which network your code will interact with. You can use a node provider service or point to your [own RPC node](/run-node#rpc-node). A comprehensive list of public and private RPC endpoints for all Flare networks is available on the [Network Configuration](/network/overview#configuration) page.

2. **Contract Address:** The address for the `RandomNumberV2` contract varies by network. You can obtain this address in two ways:
   - **From the Solidity Reference page:** Find the `RandomNumberV2` address for each network on the [Solidity Reference](/network/solidity-reference) page.

     **OR**

   - **Query the FlareContractRegistry Contract:** The `FlareContractRegistry` contract has the same address across all networks. You can query it to get the `RandomNumberV2` contract address. Refer to the specific language guides for examples:
     - [JavaScript](/network/guides/flare-for-javascript-developers#make-query)
     - [Python](/network/guides/flare-for-python-developers#make-query)
     - [Rust](/network/guides/flare-for-rust-developers#make-query)
     - [Go](/network/guides/flare-for-go-developers#make-query)

:::tip[Polling interval]

The value updates every 90s (voting round).
Poll no more than once per round or subscribe to the contract's update in your client.

:::

<Tabs block>
  <TabItem value="web3js" label="web3.js" default>
    
    This example uses [web3.js](https://github.com/web3/web3.js) to retrieve a secure random number on Flare Testnet Coston2.

    ```bash
    npm install web3
    ```

    <CodeBlock language="javascript" title="secure_random.js">
      {SecureRandomWeb3Js}
    </CodeBlock>

  </TabItem>
  <TabItem value="ethersjs" label="ethers.js">
    
    This example uses [ethers.js](https://github.com/ethers-io/ethers.js/) to retrieve a secure random number on Flare Testnet Coston2.

    ```bash
    npm install ethers
    ```

    <CodeBlock language="javascript" title="secure_random.js">
      {SecureRandomEthersJs}
    </CodeBlock>

  </TabItem>
  <TabItem value="web3py" label="web3.py">

    This example uses [web3.py](https://github.com/ethereum/web3.py) to retrieve a secure random number on Flare Testnet Coston2.

    <Tabs groupId="python">
      <TabItem value="uv" label="uv" default>

        ```bash
        uv add web3
        ```

      </TabItem>
      <TabItem value="pip" label="pip">

        ```bash
        pip install web3
        ```

      </TabItem>
    </Tabs>

    <CodeBlock language="python" title="secure_random.py">
      {SecureRandomWeb3Py}
    </CodeBlock>

  </TabItem>
  <TabItem value="alloyrs" label="alloy-rs">

    This example uses [alloy-rs](https://github.com/alloy-rs) to retrieve a secure random number on Flare Testnet Coston2.

    ```bash
    cargo add alloy eyre tokio
    ```

    <CodeBlock language="rust" title="secure_random.rs">
      {SecureRandomRust}
    </CodeBlock>

  </TabItem>
  <TabItem value="goethereum" label="go-ethereum">
    This example uses the Go API from [Geth](https://geth.ethereum.org) to retrieve a secure random number on Flare Testnet Coston2.

    ```bash
    go get github.com/ethereum/go-ethereum/ethclient
    ```
    The project structure should look like:

    ```plaintext
    developer-hub-go/
    ├── coston2/
    │   └── *.go
    ├── flare/
    │   └── *.go
    ├── main.go
    ├── go.mod
    └── go.sum
    ```

    With Go, you need to manually fetch the contract's ABI and generate the Go bindings.
    Copy the [RandomNumberV2 ABI](https://api.routescan.io/v2/network/testnet/evm/114/etherscan/api?module=contract&action=getabi&address=0x5CdF9eAF3EB8b44fB696984a1420B56A7575D250&format=raw) and paste it into a file named `RandomNumberV2.abi`, located in the root of your project, i.e. same level as `go.mod`. Then using [abigen](https://geth.ethereum.org/docs/tools/abigen), generate the Go bindings.

    ```bash
    abigen --abi RandomNumberV2.abi --pkg coston2 --type RandomNumberV2 --out coston2/RandomNumberV2.go
    ```

    <CodeBlock language="go" title="coston2/secure_random.go">
      {SecureRandomGo}
    </CodeBlock>

  </TabItem>
</Tabs>

## Watch the video

<YoutubeEmbed videoId="fdfeWwtd56I?"></YoutubeEmbed>
